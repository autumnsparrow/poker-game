<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sky.game.service.persistence.UserItemsMapper" >
  <resultMap id="BaseResultMap" type="com.sky.game.service.domain.UserItems" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
     <id column="id" property="id" jdbcType="BIGINT" />
    <result column="user_account_id" property="userAccountId" jdbcType="BIGINT" />
    <result column="item_id" property="itemId" jdbcType="BIGINT" />
    <result column="item_value" property="itemValue" jdbcType="INTEGER" />
    <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
    
    <association property="item" column="item_id" select="com.sky.game.service.persistence.ItemMapper.selectByPrimaryKey"></association>
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, user_account_id, item_id, item_value,update_time
  </sql>
  <select id="selectMyPrices" resultType="com.sky.game.service.domain.MyPrice" parameterType="java.lang.Long" >
  select u.id,i.id itemId,i.name,i.description as priceDis,(select url from icon where id=i.icon_id) iconImg,i.type 
,u.item_value as priceNum,u.update_time as getTime,(select left_num from item_count where item_id=i.id and type=2) as resDay 
from user_items u,item i where u.item_id=i.id and u.user_account_id=#{userId,jdbcType=BIGINT} and i.item_type=5;
  </select>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    select 
    <include refid="Base_Column_List" />
    from user_items
    where id = #{id,jdbcType=BIGINT}
  </select>
  <select id="selectUserItems" resultMap="BaseResultMap" parameterType="hashmap" >
    select 
    <include refid="Base_Column_List" />
    from user_items where item_id=(select item_id from exchange where id=#{id}) and user_account_id=#{userId}
  </select>
  <insert id="insert" parameterType="com.sky.game.service.domain.UserItems" >
    insert into user_items (id, user_account_id, item_id, 
      item_value)
    values (#{id,jdbcType=BIGINT}, #{userAccountId,jdbcType=BIGINT}, #{itemId,jdbcType=BIGINT}, 
      #{itemValue,jdbcType=INTEGER},#{update_time,jdbcType=TIMESTAMP})
  </insert>
  <insert id="insertUserItems" parameterType="hashmap" >
    insert into user_items (id, user_account_id, item_id,item_value,update_time)
    values (null,#{userId},(select item_id from exchange where id=#{id}),(select total_count from exchange where id=#{id}),now())
  </insert>
  
  <insert id="insertReditUser" parameterType="long" >
    insert into user_items ( user_account_id, item_id, 
      item_value,update_time)
    values (#{userId},1001,1000,now())
  </insert>
  <insert id="insertSelective" parameterType="com.sky.game.service.domain.UserItems" >
    insert into user_items
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="userAccountId != null" >
        user_account_id,
      </if>
      <if test="itemId != null" >
        item_id,
      </if>
      <if test="itemValue != null" >
        item_value,
      </if>
      <if test="updateTime != null" >
        update_time,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=BIGINT},
      </if>
      <if test="userAccountId != null" >
        #{userAccountId,jdbcType=BIGINT},
      </if>
      <if test="itemId != null" >
        #{itemId,jdbcType=BIGINT},
      </if>
      <if test="itemValue != null" >
        #{itemValue,jdbcType=INTEGER},
      </if>
      <if test="updateTime != null" >
        #{update_time,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.sky.game.service.domain.UserItems" >
    update user_items
    <set >
      <if test="userAccountId != null" >
        user_account_id = #{userAccountId,jdbcType=BIGINT},
      </if>
      <if test="itemId != null" >
        item_id = #{itemId,jdbcType=BIGINT},
      </if>
      <if test="itemValue != null" >
        item_value = #{itemValue,jdbcType=INTEGER},
      </if>
      <if test="updateTime != null" >
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.sky.game.service.domain.UserItems" >
    update user_items
    set user_account_id = #{userAccountId,jdbcType=BIGINT},
      item_id = #{itemId,jdbcType=BIGINT},
      item_value = #{itemValue,jdbcType=INTEGER},
      update_time=now()
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateUserGoods"  parameterType="hashmap">
   update user_items set item_value=item_value+(select total_count from exchange where id=#{id}),update_time=now() where item_id=(select item_id from exchange where id=#{id}) and user_account_id=#{userId}
  </update>
  <update id="decUserGolds"  parameterType="hashmap">
    update user_items set item_value=item_value-(select from_item_count from exchange where id=#{id}),update_time=now()  

where item_id=(select from_item_id from exchange where id=#{id}) and user_account_id=#{userId}
  </update>
  <update id="decUserCoins"  parameterType="hashmap">
    update user_items set item_value=item_value-#{value},update_time=now()  

where item_id=(select from_item_id from exchange where id=#{id}) and user_account_id=#{userId}
  </update>
  <!--金币对换  减少元宝 钻石 -->
  <update id="decUserGoldingot" parameterType="hashmap">
  
  update user_items a set item_value = item_value-(select from_item_count from exchange b where id =#{exchangeId}),update_time=now() where a.user_account_id=#{userId} and a.item_id=(select from_item_id from exchange b where id=#{exchangeId});
  </update>
  <!-- 查询用户对换物品数 -->
 <select id="selectUserExchangeItem" parameterType="hashmap" resultMap="BaseResultMap">
  select * from user_items where  user_account_id=#{userId} and item_id=(select from_item_id from exchange b where id =#{exchangeId});
 </select>
  <update id="updateUserGolds" parameterType="hashmap">
  update user_items a set item_value = item_value+(select total_count from exchange b where id =#{exchangeId}),update_time=now() where a.user_account_id=#{userId} and a.item_id=1001;
  </update>
  <update id="updateUsergm" parameterType="hashmap">
  update user_items a set item_value = item_value+(select total_count from store b where id =#{id}),update_time=now() where 
   a.user_account_id=#{userId} and a.item_id=1001;
  </update>
  <!-- 背包我的物品 -->
  <select id="selectMyGood" resultType="com.sky.game.service.domain.MyGood">
  select b.id,b.item_id itemId,a.name,a.description goodsDis,b.item_value goodsNum,(select url from icon where 
  id=a.icon_id) iconImg,a.item_type itemType from item a join user_items b on a.id=b.item_id where 
  b.user_account_id=#{id} and a.type in(4,5,6,7) and a.item_type in(1,2,3,9) order by id desc;
  </select>
  
  <delete id="userPriceDes" parameterType="long" >
     delete from user_items where id=#{id}
  </delete>
  <!-- 查询用户的元宝数 -->
  <select id="selectUserGold" resultMap="BaseResultMap" parameterType="long"> 
   select * from user_items where item_id=1002 and user_account_id=#{userId};
  </select>
  <!-- 查询用户金币数 -->
   <select id="selectUserCoin" resultMap="BaseResultMap" parameterType="long">
  select * from user_items where item_id=1001 and user_account_id=#{userId};
  </select>
  
  <select id="selectItemValue" parameterType="hashmap" resultType="long">
  select count(item_value) from user_items where item_id = (select item_id from exchange where id=#{id}) and user_account_id=#{userId};
  </select>
  <select id="selectTotalCount" parameterType="long" resultType="long">  
  select total_count from exchange where id=#{id};
  </select>
  <select id="selectPlayerCoin" resultType="int" parameterType="long">
  select item_value from user_items where item_id=1001 and user_account_id=#{userId};
  </select>
  
 <update id="updateUserCoin" parameterType="hashmap">
 update user_items set item_value=item_value+#{count} where item_id=1001 and user_account_id=#{userId};
 </update>
 <update id="decDeposit" parameterType="hashmap">
 update user_items set item_value=item_value-#{saveMoney} where item_id=1001 and user_account_id=#{userId}; 
 </update>
  <update id="decUserCoin" parameterType="hashmap">
   update user_items set item_value=item_value-#{count} where item_id=1001 and user_account_id=#{userId};
  </update>
  
  <!-- 用户头像购买 -->
  <insert id="insertUserHead" parameterType="hashmap">
     insert into user_items values(null,#{userId},#{itemId},1,now());
  </insert>
  <select id="selectDescriptById" parameterType="long" resultType="string">
    select description from item where id=#{itmeId}
  </select>
  <update id="updateUserCoinNum" parameterType="hashmap">
    update user_items set item_value=item_value-#{value} where user_account_id=#{userId} and item_id=1001;
  </update>
  <!-- 拍买行     -->
  <update id="updateUserDimNum" parameterType="hashmap">
    update user_items set item_value=item_value-#{value} where user_account_id=#{userId} and item_id=1003;
  </update>
  <update id="updateUserSysNum" parameterType="hashmap">
    update user_items set item_value=item_value-#{value} where user_account_id=#{userId} and item_id=1002;
  </update>
  <select id="selectTPI" parameterType="long" resultType="com.sky.game.service.domain.TuPianId">
   select distinct icon_id iconId from user_items u,item i where u.item_id=i.id and i.item_type in(6,7) and u.user_account_id=#{userId,jdbcType=BIGINT}
  </select>
  
  <!-- 拍买 -->
  <update id="updateOwnerCoin" parameterType="hashmap">
    update user_items set item_value=item_value+#{money} where user_account_id=#{ownerId} and item_id=1001;
  </update>
  <update id="updateOwnerSys" parameterType="hashmap">
    update user_items set item_value=item_value+#{money} where user_account_id=#{ownerId} and item_id=1002;
  </update>
  <update id="updateOwnerDim" parameterType="hashmap">
    update user_items set item_value=item_value+#{money} where user_account_id=#{ownerId} and item_id=1003;
  </update>
  <!-- 修改用户金币sql -->
   <update id="updateUserGold" parameterType="hashmap">
  update user_items set item_value=item_value+#{goldAdd},update_time=now() where user_account_id=#{userId} and item_id=1001; 
  </update>
  <insert id="insertUserGold" parameterType="hashmap">
  insert into user_items values(null,#{userId},'1001',#{goldAdd},now());
  </insert>
  
  <update id="updateGiftGold" parameterType="hashmap">
    update user_items set item_value=item_value+#{goldGift},update_time=now() where user_account_id=#{userId} and item_id=1001;
  </update>
   <!--  查询用户金币数 -->
  <select id="selectByUserId" parameterType="long" resultMap="BaseResultMap">
    select * from user_items where user_account_id=#{userId} and item_id=1001;
  </select>
  <insert id="insertLottery" parameterType="hashmap">
  insert into user_items(id,user_account_id,item_id,item_value,update_time) values(NULL,#{userId},#{itemId},#{value},now());
  </insert>
  <update id="updateLottery" parameterType="hashmap">
  update user_items set item_value=item_value+#{value} where user_account_id=#{userId} and item_id=#{itemId};
  </update>
   <select id="selectUserItemsByUserId" parameterType="long" resultMap="BaseResultMap">
    select * from user_items where user_account_id=#{userId} ;
  </select>
  
   <update id="updateUserItem" parameterType="hashmap">
 	  update user_items set item_value=#{value} where user_account_id=#{userId} and item_id=#{itemId};
  </update>

  <select id="selectGoldValue" parameterType="hashmap" resultType="int">
   select ui.item_value  from user_items ui left join  user_extra ue on ui.user_account_id=ue.user_account_id
 and ue.property_id =15 where ui.item_id=1002 ORDER BY ui.item_value desc limit #{startPage},#{stopPage};
 </select>
  <select id="selectCoinValue" parameterType="hashmap" resultType="int">
   select ui.item_value  from user_items ui left join  user_extra ue on ui.user_account_id=ue.user_account_id
 and ue.property_id =15 where ui.item_id=1001 ORDER BY ui.item_value desc limit #{startPage},#{stopPage};
 </select>
  
<!-- 根据用户id和物品id查询userItems -->
<select id="selectUserItemByItemId" parameterType="hashmap" resultMap="BaseResultMap">
     select * from user_items where user_account_id=#{userId} and item_id=#{itemId};
</select>

<update id="addDeposit" parameterType="hashmap">
update user_items set item_value=item_value+#{value},update_time=now() where user_account_id=#{userId} and item_id=1001; 
</update>

 <insert id="insertUserCoin" parameterType="hashmap">
  insert into user_items values(null,#{userId},1001,#{value},now());
  </insert>
   <insert id="insertUserCoin1" parameterType="hashmap">
  insert into user_items values(null,#{userId},1001,#{count},now());
  </insert>
  
   <select id="selectUserItemByUserIdAndItemId" resultMap="BaseResultMap" parameterType="hashmap" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from user_items where user_account_id=#{param1} and item_id=#{param2} 
  </select>
    <select id="selectGoldboard" parameterType="java.util.Map"  resultType="com.sky.game.service.domain.UserItems">
     select id id,user_account_id userAccountId,item_id itemId,item_value itemValue,update_time updateTime from user_items  
where item_id=1002 ORDER BY item_value desc limit #{startPage},#{stopPage};
  </select>
  <select id="selectCoinboard"  resultMap="BaseResultMap" parameterType="hashmap"> 
   select * from user_items  where item_id=1001 order by item_value desc limit #{startPage},#{stopPage};
  </select>
  
  
  <!-- 插入积分卡 -->
  <insert id="insertIntoPoint" parameterType="hashmap">
   insert into user_items values(null,#{userId},#{itemId},1,now())
  </insert>
   <!-- 积分卡使用  删除背包里的积分卡 -->
   <delete id="deleteUserPointCard" parameterType="hashmap">
    delete from user_items where user_account_id=#{userId} and item_id=#{itemId}
   </delete>
   <!-- 修改用户背包内积分卡 -->
   <update id="updateUserBagPointCard" parameterType="hashmap">
    update user_items set user_account_id=#{userId} where user_account_id=#{ownerId} and item_id=#{itId}
   </update>
   <update id="updateAddUserItem" parameterType="hashmap">
    update user_items set item_value=item_value+#{value} where item_id=#{itemId} and user_account_id=#{userId}
   </update>
   <!-- 保存头像 -->
   <select id="selectByUrl" parameterType="hashmap" resultMap="BaseResultMap">
    select * from user_items where user_account_id=#{userId} and item_id=(select * from item where icon_id=(select id from icon where url=#{url}))
   </select>
   <insert id="insertTelCard" parameterType="hashmap">
	insert into user_items values(null,#{userId},#{itemId},1,now());   
   </insert>
   <select id="selectBeryl" parameterType="long" resultMap="BaseResultMap">
   select * from user_items where user_account_id=#{userId} and item_id=2500;
   </select>
  <update id="updateActivity1" parameterType="long">
  update user_items set item_value = item_value+5000 where user_account_id=#{userId} and item_id=1001;
  </update>
  <insert id="insertActivity2" parameterType="long">
  insert into user_items values(null,#{userId},2500,10,now());
  </insert> 
  <insert id="insertActivity3" parameterType="long">
   insert into user_items values(null,#{userId},2501,2,now());
  </insert> 
  <insert id="insertActivity4" parameterType="long">
   insert into user_items values(null,#{userId},2502,1,now());
  </insert> 
  <insert id="insertActivity5" parameterType="long">
   insert into user_items values(null,#{userId},2503,1,now());
  </insert> 
  <insert id="insertActivity6" parameterType="long">
   insert into user_items values(null,#{userId},2504,1,now());
  </insert> 
  <insert id="insertActivity7" parameterType="long">
   insert into user_items values(null,#{userId},2505,1,now());
  </insert> 
  <select id="selectActivity2" parameterType="long" resultMap="BaseResultMap">
  select * from user_items where item_id=2500 and user_account_id=#{userId};
  </select>
   <select id="selectActivity3" parameterType="long" resultMap="BaseResultMap">
  select * from user_items where item_id=2501 and user_account_id=#{userId};
  </select>
   <select id="selectActivity4" parameterType="long" resultMap="BaseResultMap">
  select * from user_items where item_id=2502 and user_account_id=#{userId};
  </select>
   <select id="selectActivity5" parameterType="long" resultMap="BaseResultMap">
  select * from user_items where item_id=2503 and user_account_id=#{userId};
  </select>
   <select id="selectActivity6" parameterType="long" resultMap="BaseResultMap">
  select * from user_items where item_id=2504 and user_account_id=#{userId};
  </select>
   <select id="selectActivity7" parameterType="long" resultMap="BaseResultMap">
  select * from user_items where item_id=2505 and user_account_id=#{userId};
  </select>
  <update id="updateActivity2" parameterType="long">
  update user_items set item_value=item_value+10 where user_account_id=#{userId} and item_id=2500;
  </update>
  <update id="updateActivity3" parameterType="long">
  update user_items set item_value=item_value+2 where user_account_id=#{userId} and item_id=2501;
  </update>
  <update id="updateActivity4" parameterType="long">
  update user_items set item_value=item_value+1 where user_account_id=#{userId} and item_id=2502;
  </update>
  <update id="updateActivity5" parameterType="long">
  update user_items set item_value=item_value+1 where user_account_id=#{userId} and item_id=2503;
  </update>
  <update id="updateActivity6" parameterType="long">
  update user_items set item_value=item_value+1 where user_account_id=#{userId} and item_id=2504;
  </update>
  <update id="updateActivity7" parameterType="long">
  update user_items set item_value=item_value+1 where user_account_id=#{userId} and item_id=2505;
  </update>
  <update id="updateRewardItem" parameterType="hashmap">
   update user_items set item_value=item_value+#{goldAdd},update_time=now() where user_account_id=#{userId} and item_id=#{itemId}; 
  </update>
  <insert id="insertRewardItem" parameterType="hashmap">
  insert into user_items values(null,#{userId},#{itemId},#{goldAdd},now());
  </insert>
  <select id="selectByItemsId" parameterType="hashmap" resultMap="BaseResultMap">
  select * from user_items where user_account_id=#{userId} and item_id=#{itemId};
  </select>
  
  

</mapper>

