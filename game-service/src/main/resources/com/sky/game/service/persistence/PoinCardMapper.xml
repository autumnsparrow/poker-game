<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sky.game.service.persistence.PoinCardMapper">
  <resultMap id="BaseResultMap" type="com.sky.game.service.domain.PoinCard">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="type_id" jdbcType="BIGINT" property="typeId" />
    <result column="start_price" jdbcType="INTEGER" property="startPrice" />
    <result column="now_price" jdbcType="INTEGER" property="nowPrice" />
    <result column="user_account_id" jdbcType="BIGINT" property="userAccountId" />
    <result column="icon_id" jdbcType="BIGINT" property="iconId" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="own_fen" jdbcType="INTEGER" property="ownFen" />
    <result column="get_time" jdbcType="TIMESTAMP" property="getTime" />
    <result column="start_time" jdbcType="TIMESTAMP" property="startTime" />
    <result column="end_time" jdbcType="TIMESTAMP" property="endTime" />
   <!--  <result column="count" jdbcType="INTEGER" property="count" /> -->
    <result column="last_tarde_price" jdbcType="INTEGER" property="lastTardePrice" />
    <result column="flag" jdbcType="INTEGER" property="flag" />
    <result column="trade_type" jdbcType="VARCHAR" property="tradeType" />
    <result column="out_type" jdbcType="VARCHAR" property="outType" />
    <result column="effect_time" jdbcType="TIMESTAMP" property="effectTime" />
    <result column="room_id" jdbcType="BIGINT" property="roomId" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, type_id, start_price, now_price, user_account_id,icon_id, name, own_fen, get_time, 
    start_time, end_time,last_tarde_price, flag, trade_type, out_type,effect_time,room_id
  </sql>
  
  
  <!-- 所有拍买物品列表 -->
  <select id="selectAuctionList" resultType="com.sky.game.service.domain.AuctionGoods">
  select p.id,timestampdiff(SECOND,current_timestamp,p.end_time) leftTime,p.name,u.name owner,u.id ownerId,p.start_price startPrice,p.trade_type tradeType,p.out_type outType,pc.description,pc.use_area useArea,pc.small_add_price smallAddPrice,p.now_price nowPrice,p.own_fen ownFen,p.start_time startTime,p.end_time endTime,pc.lose_effect_time effectTime ,i.url imgUrl from point_card p,point_card_attribute pc,user_account u ,icon i where p.type_id=pc.id and p.user_account_id=u.id and p.icon_id=i.id and p.flag=1;
  </select>
  <!-- 修改拍买行  当前价格 -->
  <update id="updateNowPrice" parameterType="hashmap">
     update point_card set now_price=#{value} where id=#{id}
  </update>
  <!-- 我的拍买行    -->
  <select id="selectMyAuctionList" parameterType="long" resultType="com.sky.game.service.domain.MyAuctionGoods">
  select p.id,p.name,pc.low_out_price lowValue,pc.hight_out_price hightValue,pc.description,pc.trade_type tradeType,pc.allow_out_type outType,pc.lose_effect_time pastTime,p.own_fen wonFen,pc.use_area useArea,i.url imgUrl from point_card p,point_card_attribute pc,icon i where p.type_id=pc.id and p.icon_id=i.id and p.flag=2 and p.user_account_id=#{userId} and p.effect_time>=now();
  </select>
  
  <update id="updateMyAuction" parameterType="hashmap">
    update point_card set start_price=#{price},now_price=#{price},trade_type=#{chooseCoin},out_type=#{type},flag=1,start_time=#{startTime},end_time=#{endTime}  where id=#{id}
  </update>
  <select id="selectByIdFindTypeId" parameterType="long" resultType="long">
    select type_id from point_card where id=#{id}
  </select>
  
  <update id="updateAuctionOutTime" parameterType="long">
    update point_card set flag=2 where id=#{id}
  </update>
  
  <update id="updateAuctionGiveAuctioner" parameterType="hashmap">
    update point_card set user_account_id=#{auctionUserId},flag=2,last_tarde_price=#{value} where id=#{pointCardId}
  </update>
   <!-- 根据id查询 auctionGoods -->
   <select id="selectAuctionById" parameterType="java.lang.Long" resultMap="BaseResultMap">
      select * from point_card where id=#{id}
   </select>
    <!-- 插入积分卡 -->
   <insert id="inserPointCard" parameterType="com.sky.game.service.domain.PoinCard">
   INSERT INTO point_card  VALUES (null,#{typeId},#{startPrice},#{nowPrice},#{userAccountId},#{name},#{ownFen},#{getTime},#{startTime},#{endTime},#{lastTardePrice},#{flag},#{tradeType},#{outType},#{iconId},#{effectTime},#{roomId})
   </insert>
   <!-- 根据userId roomId 查询用户积分卡 -->
   <select id="selectUserIsOne" parameterType="hashmap" resultMap="BaseResultMap">
   select * from point_card where user_account_id=#{userId} and room_id=#{roomId}
   </select>
   <!-- 积分卡使用   没有拍买的积分卡才能使用  -->
   <select id="selectxzUserUse" parameterType="hashmap" resultMap="BaseResultMap">
   select * from point_card where user_account_id=#{userId} and room_id=#{roomId} and flag=2
   </select>
   <!-- 删除用户使用的积分卡 -->
   <delete id="deletePointCardById" parameterType="java.lang.Long">
    delete from point_card where id=#{id}
   </delete>
</mapper>