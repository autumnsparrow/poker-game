<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sky.game.service.persistence.ItemCountMapper" >
  <resultMap id="BaseResultMap" type="com.sky.game.service.domain.ItemCount" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="all_num" property="allNum" jdbcType="INTEGER" />
    <result column="left_num" property="leftNum" jdbcType="INTEGER" />
    <result column="today_num" property="todayNum" jdbcType="INTEGER" />
    <result column="item_id" property="itemId" jdbcType="BIGINT" />
    <result column="type" property="type" jdbcType="INTEGER" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, all_num, left_num, today_num, item_id,type
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from item_count
    where id = #{id,jdbcType=BIGINT}
  </select>
  <select id="selectPriceByMap" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from item_count
    where item_id = #{itemId,jdbcType=BIGINT} and type=2
  </select>
  <insert id="insert" parameterType="com.sky.game.service.domain.ItemCount" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into item_count (id, all_num, left_num, 
      today_num, item_id,type)
    values (#{id,jdbcType=BIGINT}, #{allNum,jdbcType=INTEGER}, #{leftNum,jdbcType=INTEGER}, 
      #{todayNum,jdbcType=INTEGER}, #{itemId,jdbcType=BIGINT},#{type,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" parameterType="com.sky.game.service.domain.ItemCount" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into item_count
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="allNum != null" >
        all_num,
      </if>
      <if test="leftNum != null" >
        left_num,
      </if>
      <if test="todayNum != null" >
        today_num,
      </if>
      <if test="itemId != null" >
        item_id,
      </if>
      <if test="type != null" >
        type,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=BIGINT},
      </if>
      <if test="allNum != null" >
        #{allNum,jdbcType=INTEGER},
      </if>
      <if test="leftNum != null" >
        #{leftNum,jdbcType=INTEGER},
      </if>
      <if test="todayNum != null" >
        #{todayNum,jdbcType=INTEGER},
      </if>
      <if test="itemId != null" >
        #{itemId,jdbcType=BIGINT},
      </if>
      <if test="type != null" >
        #{type,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.sky.game.service.domain.ItemCount" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update item_count
    <set >
      <if test="allNum != null" >
        all_num = #{allNum,jdbcType=INTEGER},
      </if>
      <if test="leftNum != null" >
        left_num = #{leftNum,jdbcType=INTEGER},
      </if>
      <if test="todayNum != null" >
        today_num = #{todayNum,jdbcType=INTEGER},
      </if>
      <if test="itemId != null" >
        item_id = #{itemId,jdbcType=BIGINT},
      </if>
      <if test="type != null" >
        type = #{type,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.sky.game.service.domain.ItemCount" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update item_count
    set all_num = #{allNum,jdbcType=INTEGER},
      left_num = #{leftNum,jdbcType=INTEGER},
      today_num = #{todayNum,jdbcType=INTEGER},
      item_id = #{itemId,jdbcType=BIGINT},
      type= #{type,jdbcType=INTEGER}
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="decResCount" parameterType="java.lang.Long">
  update item_count  set all_num=all_num-(select total_count from exchange where id=#{id}),left_num=left_num-(select total_count from exchange where id=#{id}) where item_id=(select item_id from exchange where id=#{id}) and type=1;
  </update>
  
  <update id="updateReceiveItemCount" parameterType="java.lang.Long">
  update item_count  set all_num=all_num-1,left_num=left_num-1 where item_id=#{itemId} and type=2;
  </update>
 
  <update id="addReceiveItemCount" parameterType="java.lang.Long">
  update item_count  set all_num=all_num+1,left_num=left_num+1 where item_id=#{itemId} and type=2;
  </update>
  
  <update id="updateLeftCount" parameterType="java.lang.Long">
     update item_count set left_num=left+1 where item_id=#{itemId} and type=2
  </update>
  
    <select id="selectResDay" resultType="int" parameterType="long">
  select left_num from item_count where type=1 and item_id=(select item_id from exchange where id=#{id});
  </select>
  
  <!-- 每日投放 定时更新 -->
  <select id="selectAllItemCount" resultMap="BaseResultMap">
   select * from item_count
  </select>
  <update id="updateTodayNum" parameterType="hashmap">
   update item_count set all_num=#{allNum},left_num=#{leftNum} where id=#{id}
  </update>
  
  </mapper>