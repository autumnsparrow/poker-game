<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sky.game.service.persistence.UserExtraMapper">
  <resultMap id="BaseResultMap" type="com.sky.game.service.domain.UserExtra">
    <!--
      WARNING - @mbggenerated
      
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="user_account_id" jdbcType="BIGINT" property="userAccountId" />
    <result column="property_id" jdbcType="BIGINT" property="propertyId" />
    <result column="property_value" jdbcType="VARCHAR" property="propertyValue" />
    <association property="property" column="property_id" select="com.sky.game.service.persistence.PropertyMapper.selectByPrimaryKey"></association>
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, user_account_id, property_id, property_value
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from user_extra
    where id = #{id,jdbcType=BIGINT}
  </select>
  
  <select id="selectByAccountIdAndPropertyId" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from user_extra
    where user_account_id = #{param1,jdbcType=BIGINT} and property_id= #{param2,jdbcType=BIGINT} 
  </select>
  
  <select id="selectByAccountId" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from user_extra
    where user_account_id = #{id,jdbcType=BIGINT}
  </select>
  <insert id="insert" parameterType="com.sky.game.service.domain.UserExtra">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into user_extra (id, user_account_id, property_id, 
      property_value)
    values (null, #{userAccountId,jdbcType=BIGINT}, #{propertyId,jdbcType=BIGINT}, 
      #{propertyValue,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.sky.game.service.domain.UserExtra">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into user_extra
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="userAccountId != null">
        user_account_id,
      </if>
      <if test="propertyId != null">
        property_id,
      </if>
      <if test="propertyValue != null">
        property_value,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=BIGINT},
      </if>
      <if test="userAccountId != null">
        #{userAccountId,jdbcType=BIGINT},
      </if>
      <if test="propertyId != null">
        #{propertyId,jdbcType=BIGINT},
      </if>
      <if test="propertyValue != null">
        #{propertyValue,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.sky.game.service.domain.UserExtra">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update user_extra
    <set>
      <if test="userAccountId != null">
        user_account_id = #{userAccountId,jdbcType=BIGINT},
      </if>
      <if test="propertyId != null">
        property_id = #{propertyId,jdbcType=BIGINT},
      </if>
      <if test="propertyValue != null">
        property_value = #{propertyValue,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.sky.game.service.domain.UserExtra">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update user_extra
    set user_account_id = #{userAccountId,jdbcType=BIGINT},
      property_id = #{propertyId,jdbcType=BIGINT},
      property_value = #{propertyValue,jdbcType=VARCHAR}
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateNickName" parameterType="hashmap">
  update user_extra set property_value =#{NickName} where user_account_id=#{userId} and property_id=26; 
  </update>
  <update id="updateUserSign" parameterType="hashmap">
  update user_extra set property_value =#{UserSign} where user_account_id=#{userId} and property_id=9; 
  </update>
  <update id="updateUserPhone" parameterType="hashmap">
  update user_extra set property_value=#{Phone} where user_account_id=#{userId} and property_id=12;
  </update>
 <!--  保存购买头像 -->
  <update id="updateUserStartHead" parameterType="hashmap">
  update user_extra set property_value=#{url} where user_account_id=#{userId} and property_id=27;
  </update>
  <!-- 修改用户经验值 -->
  <update id="updateAddUserExp" parameterType="hashmap">
  update user_extra set property_value=property_value+#{exp} where user_account_id=#{userId} and property_id=8;
  </update>
  <select id="selectLevelExp" parameterType="int" resultType="int">
  select max(exp-#{experience})+#{experience} from user_level
   <![CDATA[where exp<#{experience};]]> 
  </select>
  <select id="selectNextExp" parameterType="int" resultType="int">
  select min(exp-#{experience})+#{experience} from user_level 
  <![CDATA[where exp>#{experience};]]>
  </select>
  
  <select id="userPropertyList" resultType="com.sky.game.service.domain.PropertyShow" parameterType="long">
  select p.name,u.property_value value from user_extra u,property p where u.property_id=p.id and user_account_id=#{userId};
  </select>
  
  
  <!-- 密码找回，根据电话号码查询user_extra 表 -->
  <select id="selectUserExtraByPhone" resultMap="BaseResultMap" parameterType="string">
    select * from user_extra where property_id=12 and property_value=#{phone}
  </select>
 <!--  根据电话号码找回账号 -->
  <select id="selectUserAccountByPhone" resultType="string" parameterType="string">
  select ua.name from user_extra ue,user_account ua where ue.user_account_id=ua.id and ue.property_id=12 and ue.property_value=#{phone};
  </select>
  <!--根据用户id查询用户的昵称属性  -->
  <select id="selectNickNameByUserId" resultMap="BaseResultMap" parameterType="java.lang.Long">
   select * from user_extra where user_account_id=#{userId} and property_id=26;
  </select>

 <select id="selectUserExtra" parameterType="hashmap" resultMap="BaseResultMap">
 select * from user_extra where property_id =8 ORDER BY property_value+0 desc limit #{startPage},#{stopPage};
 </select>
  <select id="selectAllPhone" resultType="com.sky.game.service.domain.UserExtra">
     select * from user_extra where property_id=12
  </select>
 <!-- 最大经验数   个人中心中的经验进度   GU0008 --> 
  <select id="selectMaxExp" resultType="int">
      select max(exp) from user_level;
   </select>
   <update id="updateReputationValue" parameterType="hashmap">
   update user_extra set property_value= property_value+#{value} where property_id=28 and user_account_id=#{userId};
   </update>
   <!--查询用户是否是vip -->
   <select id="selectUserIsVip" parameterType="java.lang.Long" resultMap="BaseResultMap">
    select * from user_extra where property_id=21 and user_account_id=#{userId}
   </select>
   <update id="updateUserExtraVip" parameterType="long">
    update user_extra set property_value=1 where property_id=21 and user_account_id=#{userId};
   </update>
   <insert id="insertUserExtraVip" parameterType="long">
    insert into user_extra values(null,#{userId},21,"1");
   </insert>
   
   <!--根据 用户id 和property_id 查询 user_extra -->
   <select id="selectByUserIdAndProperty" parameterType="hashmap" resultMap="BaseResultMap">
    select * from user_extra where user_account_id=#{userId} and property_id=#{propertyId}
   </select>
   <select id="selectReputationValue" parameterType="long" resultMap="BaseResultMap">
   select property_value from user_extra where user_account_id=#{userId} and property_id=28;
   </select>
   <update id="updateUserVipType" parameterType="long">
   update user_extra set property_value=2 where user_account_id=#{userId} and property_id=21;
   </update>
   <!-- 删除游客相应属性 -->
   <delete id="deleteUserPropertyId" parameterType="java.lang.Long">
    delete from user_extra where user_account_id=#{userAccountId} and property_id in (13,26,27);
   </delete>
   <!-- 修改用户属性     真对大师分，天梯分  ，魅力值 -->
   <update id="updateDTM" parameterType="hashmap">
    update user_extra set property_value=#{propertyValue} where property_id=#{propertyId} and user_account_id=#{userId}
   </update>
   
   <!-- 添加  大师分  天梯分    魅力值 -->
   <insert id="insertDTM" parameterType="hashmap">
    insert into user_extra values(null,#{userId},#{propertyId},#{propertyValue});
   </insert>
</mapper>